<%-include("../../view/partials/user/header")%>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
ial zoom styles */
.product-image-container {
  position: relative;
  width: 100%;
  max-width: 500px;
}

.img-zoom-container {
  position: relative;
  width: 100%;
}

.img-zoom-lens {
  position: absolute;
  border: 2px solid #d4d4d4;
  width: 100px;
  height: 100px;
  background-color: rgba(255, 255, 255, 0.4);
  cursor: none;
  display: none; /* Initially hidden */
}

.img-zoom-result {
  position: fixed;  /* Changed to fixed */
  right: 20px;     /* Distance from right edge */
  top: 50%;        /* Center vertically */
  transform: translateY(-50%); /* Perfect vertical centering */
  border: 2px solid #d4d4d4;
  width: 400px;
  height: 400px;
  background-repeat: no-repeat;
  display: none;   /* Initially hidden */
  z-index: 1000;   /* Ensure it's above other elements */
  background-color: white;
}

/* Show zoom elements on container hover */
.img-zoom-container:hover .img-zoom-lens,
.img-zoom-container:hover .img-zoom-result {
  display: block;
}

.product-image {
  width: 100%;
  height: auto;
  display: block;
}
.product-details {
    height: 100%;
    padding: 30px;
    background-color: #f8f9fa;
}

.product-carousel {
    margin-bottom: 0;
}

.img-zoom-container {
    position: relative;
    overflow: hidden;
}

@media (max-width: 991px) {
    .product-details {
        margin-top: 30px;
    }
}

</style>

<!-- Breadcrumb Start -->
<div class="container-fluid">
    <div class="row px-xl-5">
        <div class="col-12">
            <nav class="breadcrumb bg-light mb-30">
                <a class="breadcrumb-item text-dark" href="#">Home</a>
                <a class="breadcrumb-item text-dark" href="#">Shop</a>
                <span class="breadcrumb-item active">Shop Detail</span>
            </nav>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->




    <div class="container-fluid pb-5">
        <div class="row px-xl-5">
            <!-- Left side - Product Images -->
            <div class="col-lg-5 mb-30">
                <div id="product-carousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner bg-light product-carousel">
                        <div class="carousel-item active">
                            <div class="img-zoom-container" onmousemove="zoomImage(event)" onmouseleave="resetZoom(event)">
                                <img class="w-100 h-100" src="/uploads/<%=product.productImage[0]%>" alt="Product Image">
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="img-zoom-container" onmousemove="zoomImage(event)" onmouseleave="resetZoom(event)">
                                <img class="w-100 h-100" src="/uploads/<%=product.productImage[1]%>" alt="Product Image">
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="img-zoom-container" onmousemove="zoomImage(event)" onmouseleave="resetZoom(event)">
                                <img class="w-100 h-100" src="/uploads/<%=product.productImage[2]%>" alt="Product Image">
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="img-zoom-container" onmousemove="zoomImage(event)" onmouseleave="resetZoom(event)">
                                <img class="w-100 h-100" src="/uploads/<%=product.productImage[3]%>" alt="Product Image">
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                        <i class="fa fa-2x fa-angle-left text-dark"></i>
                    </a>
                    <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                        <i class="fa fa-2x fa-angle-right text-dark"></i>
                    </a>
                </div>
            </div>
    
            <!-- Right side - Product Details -->
            <div class="col-lg-7 mb-30">
                <div class="product-details">
                    <h3><%=product.productName%></h3>
                    <div class="d-flex mb-3">
                        <div class="text-primary mr-2">
                            <small class="fas fa-star"></small>
                            <small class="fas fa-star"></small>
                            <small class="fas fa-star"></small>
                            <small class="fas fa-star-half-alt"></small>
                            <small class="far fa-star"></small>
                        </div>
                        <small class="pt-1">(99 Reviews)</small>
                    </div>
                    
                    <div class="d-flex  mt-2">
                        <h5><%=product.salePrice%></h5><h6 class="text-muted ml-2 mt-1"><del><%=product.regularPrice%></del></h6>
                    </div>


                    <!-- Sizes -->
                    <div class="d-flex mb-3">
                        <strong class="text-dark mr-3">Sizes:</strong>
                        <form>
                            <% if (product.sizes && product.sizes.length > 0) { %>
                                <% product.sizes.forEach((sizeData, index) => { %>
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input type="radio" 
                                            class="custom-control-input" 
                                            id="size-<%= index %>" 
                                            name="size" 
                                            value="<%= sizeData.size %>"
                                            data-quantity="<%= sizeData.quantity %>">
                                        <label class="custom-control-label" for="size-<%= index %>">
                                            <%= sizeData.size %> 
                                            <small>(<%=sizeData.quantity%> available)</small>
                                        </label>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <p>No size information available</p>
                            <% } %>
                        </form>
                    </div>
    
                    <!-- Colors -->
                    <div class="d-flex mb-4">
                        <strong class="text-dark mr-3">Colors:</strong>
                        <% if (product.color) { %>
                            <% const colors = product.color.split(',').map(color => color.trim()) %>
                            <form>
                                <% colors.forEach((color, index) => { %>
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input type="radio" 
                                            class="custom-control-input" 
                                            id="color-<%= index %>" 
                                            name="color"
                                            value="<%= color %>">
                                        <label class="custom-control-label" for="color-<%= index %>">
                                            <%= color %>
                                        </label>
                                    </div>
                                <% }); %>
                            </form>
                        <% } %>
                    </div>


                    <div class="product_sort_info font-xs mb-30">
                        <ul>
                            <li class="mb-10">
                                <i class="fi-rs-crown mr-5"></i> Brand: 
                                <% if (product.brand && product.brand.brandName) { %>
                                    <%= product.brand.brandName %>
                                <% } else { %>
                                    Not Specified
                                <% } %>
                            </li>
                            <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> Category: <%= product.category.name %></li>
                            <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return Policy</li>
                            <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available</li>
                        </ul>
                    </div>
    
                    <!-- Quantity and Add to Cart -->
                    <form action="/cart/add" method="POST">
                        <input type="hidden" name="productId" value="<%= product._id %>">
                        <input type="hidden" name="selectedSize" id="selectedSize">
                        <input type="hidden" name="selectedColor" id="selectedColor">
                        
                        <div class="d-flex align-items-center mb-4 pt-2">
                            <div class="input-group quantity mr-3" style="width: 130px;">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-primary btn-minus">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                                <input type="number" 
                                    class="form-control bg-secondary border-0 text-center" 
                                    name="quantity" 
                                    value="1" 
                                    min="1"
                                    id="quantityInput">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-primary btn-plus">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary px-3" id="addToCartBtn">
                            <i class="fa fa-shopping-cart mr-1"></i> Add To Cart
                        </button>
                    </form>
                    
    
                    <!-- Product Meta -->
                    <ul class="product-meta font-xs color-grey mt-50">
                        <li class="mb-2">Category: <a href="#"><%= product.category.name %></a></li>
                        <li class="mb-10">
                            <i class="fi-rs-crown mr-5"></i> Brand: 
                            <% if (product.brand && product.brand.brandName) { %>
                                <%= product.brand.brandName %>
                            <% } else { %>
                                Not Specified
                            <% } %>
                        </li>
                        <li>Total Stock: <span class="in-stock text-success ml-1"><%= product.quantity %> Items</span></li>
                    </ul>
    
                    <!-- Social Share -->
                    <div class="d-flex pt-2">
                        <strong class="text-dark mr-2">Share on:</strong>
                        <div class="d-inline-flex">
                            <a class="text-dark px-2" href=""><i class="fab fa-facebook-f"></i></a>
                            <a class="text-dark px-2" href=""><i class="fab fa-twitter"></i></a>
                            <a class="text-dark px-2" href=""><i class="fab fa-linkedin-in"></i></a>
                            <a class="text-dark px-2" href=""><i class="fab fa-pinterest"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row px-xl-5">
        <div class="col">
            <div class="bg-light p-30">
                <div class="nav nav-tabs mb-4">
                    <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Description</a>
                    <!-- <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Information</a> -->
                    <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-3">Reviews (0)</a>
                </div>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab-pane-1">
                        <h4 class="mb-3">Product Description</h4>
                        <p class="mb-4"><%=product.description%></p>

                        
                    </div>
                   
                           
                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab-pane-3">
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-4">1 review for <%=product.productName%></h4>
                                <div class="media mb-4">
                                    <img src="img/user.jpg" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                                    <div class="media-body">
                                        <h6>John Doe<small> - <i>01 Jan 2025</i></small></h6>
                                        <div class="text-primary mb-2">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                            <i class="far fa-star"></i>
                                        </div>
                                        <p>"Affordable yet high-quality. It’s a fantastic deal for the price and works better than I anticipated."</p>
                                    </div>
                                </div>
                                <div class="media mb-4">
                                    <img src="img/user.jpg" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                                    <div class="media-body">
                                        <h6>Devu mon<small> - <i>01 Jan 2025</i></small></h6>
                                        <div class="text-primary mb-2">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                            <i class="far fa-star"></i>
                                        </div>
                                        <p>"I’m very satisfied with this purchase. It does the job perfectly and is easy to use. Would definitely buy it again."</p>
                                    </div>
                                </div>
                                <div class="media mb-4">
                                    <img src="img/user.jpg" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                                    <div class="media-body">
                                        <h6>Belwin Raphel<small> - <i>01 Jan 2025</i></small></h6>
                                        <div class="text-primary mb-2">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                            <i class="far fa-star"></i>
                                        </div>
                                        <p>"This product is built to last. The materials feel premium, and it performs exactly as expected. Worth every penny!"</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4 class="mb-4">Leave a review</h4>
                                <small>Your email address will not be published. Required fields are marked *</small>
                                <div class="d-flex my-3">
                                    <p class="mb-0 mr-2">Your Rating * :</p>
                                    <div class="text-primary">
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                </div>
                                <form>
                                    <div class="form-group">
                                        <label for="message">Your Review *</label>
                                        <textarea id="message" cols="30" rows="5" class="form-control"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="name">Your Name *</label>
                                        <input type="text" class="form-control" id="name">
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Your Email *</label>
                                        <input type="email" class="form-control" id="email">
                                    </div>
                                    <div class="form-group mb-0">
                                        <input type="submit" value="Leave Your Review" class="btn btn-primary px-3">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Shop Detail End -->


<!-- Products Start -->
<div class="container-fluid py-5">
    <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">Related Products</span></h2>
    <div class="row px-xl-5">
        <div class="col">
            <div class="owl-carousel related-carousel">
                <%console.log(relatedProducts)%>
                <!-- <% if (relatedProducts && relatedProducts.length > 0) { %> -->
                    <% relatedProducts.forEach(related => { %>
                <div class="product-item bg-light">
                    <div class="product-img position-relative overflow-hidden">
                        <img class="img-fluid w-100" src="/uploads/<%=related.productImage[0]%>" alt="<%=related.productName%>">
                        <div class="product-action">
                            <a class="btn btn-outline-dark btn-square" href=""><i class="fa fa-shopping-cart"></i></a>
                            <a class="btn btn-outline-dark btn-square" href=""><i class="far fa-heart"></i></a>
                            <a class="btn btn-outline-dark btn-square" href=""><i class="fa fa-sync-alt"></i></a>
                            <a class="btn btn-outline-dark btn-square" href=""><i class="fa fa-search"></i></a>
                        </div>
                    </div>
                    <div class="text-center py-4">
                        <a class="h6 text-decoration-none text-truncate" href="/productDetails?id=<%=related._id%>"><%=related.productName%></a>
                        <div class="d-flex align-items-center justify-content-center mt-2">
                            <h5><%=related.salePrice%></h5><h6 class="text-muted ml-2"><del><%=related.regularPrice%></del></h6>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mb-1">
                            <small class="fa fa-star text-primary mr-1"></small>
                            <small class="fa fa-star text-primary mr-1"></small>
                            <small class="fa fa-star text-primary mr-1"></small>
                            <small class="fa fa-star text-primary mr-1"></small>
                            <small class="fa fa-star text-primary mr-1"></small>
                            <small>(99)</small>
                        </div>
                    </div>
                </div>
                <% });%>
                <!-- <% } else { %>
                    <p>No related products available.</p>
                <% } %> -->
            </div>
          </div>
          </div>
          </div>      
<!-- Products End -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
 function zoomImage(e) {
    const zoomer = e.currentTarget;
    const image = zoomer.querySelector('img');
    
    // Calculate relative position
    const rect = zoomer.getBoundingClientRect();
    const x = (e.clientX - rect.left) / zoomer.offsetWidth;
    const y = (e.clientY - rect.top) / zoomer.offsetHeight;
    
    const zoomLevel = 2;
    
    // Add zooming class to parent to hide controls
    document.querySelector('.product-carousel').classList.add('zooming');
    
    // Set transform origin and scale
    image.style.transformOrigin = `${x * 100}% ${y * 100}%`;
    image.style.transform = `scale(${zoomLevel})`;
}

function resetZoom(e) {
    const image = e.currentTarget.querySelector('img');
    
    // Remove zooming class to show controls
    document.querySelector('.product-carousel').classList.remove('zooming');
    
    // Reset transform
    image.style.transformOrigin = 'center center';
    image.style.transform = 'scale(1)';
}

// Initialize zoom for carousel
document.addEventListener('DOMContentLoaded', function() {
    // Handle carousel slide event
    $('#product-carousel').on('slid.bs.carousel', function() {
        // Reset zoom on slide change
        const activeImage = document.querySelector('.carousel-item.active img');
        if (activeImage) {
            activeImage.style.transformOrigin = 'center center';
            activeImage.style.transform = 'scale(1)';
        }
    });
});




    document.addEventListener('DOMContentLoaded', function () {
        const btnPlus = document.querySelector('.btn-plus');
        const btnMinus = document.querySelector('.btn-minus');
        const quantityInput = document.querySelector('input[name="quantity"]');

        if (btnPlus) {
            btnPlus.addEventListener('click', () => {
                const currentValue = parseInt(quantityInput.value, 10) || 1;
                quantityInput.value = currentValue + 1;
            });
        }

        if (btnMinus) {
            btnMinus.addEventListener('click', () => {
                const currentValue = parseInt(quantityInput.value, 10) || 1;
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            });
        }
    });





    //////////product fetching////
    document.addEventListener('DOMContentLoaded', function() {
    const sizeInputs = document.querySelectorAll('input[name="size"]');
    const colorInputs = document.querySelectorAll('input[name="color"]');
    const quantityInput = document.getElementById('quantityInput');
    const selectedSizeInput = document.getElementById('selectedSize');
    const selectedColorInput = document.getElementById('selectedColor');
    const addToCartBtn = document.getElementById('addToCartBtn');

    // Handle size selection
    sizeInputs.forEach(input => {
        input.addEventListener('change', function() {
            const maxQuantity = parseInt(this.dataset.quantity);
            quantityInput.max = maxQuantity;
            selectedSizeInput.value = this.value;
            
            // Reset quantity if it's more than available
            if (parseInt(quantityInput.value) > maxQuantity) {
                quantityInput.value = maxQuantity;
            }
        });
    });

    // Handle color selection
    colorInputs.forEach(input => {
        input.addEventListener('change', function() {
            selectedColorInput.value = this.value;
        });
    });

    // Validate form before submission
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!selectedSizeInput.value) {
            e.preventDefault();
            alert('Please select a size');
        }
        if (!selectedColorInput.value) {
            e.preventDefault();
            alert('Please select a color');
        }
    });
});


</script>
<%-include("../../view/partials/user/footer")%>

